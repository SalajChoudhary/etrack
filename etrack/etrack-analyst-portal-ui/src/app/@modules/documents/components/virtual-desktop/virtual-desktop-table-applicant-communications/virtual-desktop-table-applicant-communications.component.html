<div class="row mb-3">
    <div class="col-12">
        <div class="header">
          <h3 class="header-1b mb-0"> Applicant Communications</h3>
          <div>
            <button [disabled]="isReadOnly" (click)="openAddModal()" class="btn btn-sm btn-outline-dark nextbutton mb-2 upload">
              Add New
            </button>
          </div>
        </div>
        <hr class="mt-1">
    </div>
    <div class="col-12">
      <div class="scrollable">
        <table aria-labelledby="Applicant Communications Table" class="table table-borderless table-striped mb-0">
          <tbody role="rowgroup">
            <tr role="columnheader" *ngFor="let communications of communicationsHistory">
              <td role="cell" scope="row">
                <div> 
                  <a (click)="subjectClicked(communications)" class="btn typo-2 btn-link p-0"> {{communications.emailSubject}} </a> 
                  <mat-icon class="attachment_image" *ngIf="communications?.fileAttachedInd">attachment</mat-icon>
                </div>
                <div>{{getDocumentsList(communications.correspondenceId)}}</div>
              </td>
              <td role="cell" scope="row">
                <div class="float-right">
                  <div class="mb-2 text-right" [ngClass]="{'mt-2': communications?.fileAttachedInd}">{{communications.createDate | date: "MM/dd/yyyy"}}</div>
                  <div class="text-right">
                    <input type="checkbox" [disabled]="communications?.aplctCorrespCompltdInd"
                      [checked]="communications?.aplctCorrespCompltdInd"
                      (change) ='closedClicked(communications, $event)'/> Close
                  </div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="float-right mr-2" *ngIf="showServerError">
      <app-server-error-message [serverErrorMessage]="serverErrorMessage"></app-server-error-message>
    </div>
</div>

<app-custom-modal-popup #confirmationPopup [modalConfig]="confirmModalConfig">
  <ng-container>
    <div>
    <p class="text-center mt-2">Mark this correspondence Complete and save <br> correspondence to DMS.</p>
    <div class="text-center mb-2">
      <button
        class="btn btn-sm btn-primari nextbutton mb-2 mr-2 upload"
        (click)="confirmOkClicked()"
      >
        OK
      </button>
      <button
        (click)="confirmCloseClicked()"
        type="button"
        class="btn btn-sm btn-outline-dark closebutton mb-2"
      >
        Cancel
      </button>
    </div>
  </div>
  </ng-container>
</app-custom-modal-popup>

<app-custom-modal-popup #addModal [modalConfig]="modalConfig">
    <app-add-applicant-communications *ngIf="isAddModalOpen | async" 
        [documents]="documents"
        [existingRequestedDocs] = "existingRequestedDocs"
        [projectId]="projectId"
        (onClose)="onClose($event)">
    </app-add-applicant-communications>
</app-custom-modal-popup>

<app-email-compose (popUpClosed)="onEmailClose()" #emailModal 
  [existingData]="emailData"
  [requestedDocs]="requestedDocs">
</app-email-compose>
